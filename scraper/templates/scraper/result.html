{% extends 'scraper/base.html' %}
{% load static %}

{% block content %}
    <!-- This script can't be extracted to it's own JavaScript file -->
    <script>
        var item = {
            image: "{{ image }}",
            title: "{{ title }}",
            rating: "{{ price_rating }}",
            price: "{{ price }}"
        };
        var shortened_url = "{{ shortened_url }}";
        localStorage.setItem(shortened_url, JSON.stringify(item));
    </script>

    <a href="{% url 'index' %}" class="btn btn-outline-secondary mt-3 mx-3"><i class="fas fa-chevron-left"></i> Go Back</a>
    <div class="container md mt-5">
        <h1 class="text-center mb-4">Analysis Report</h1>
        <p class="text-center lead">
            Dynamic reports delivering <span class="gradient-text">invaluable</span> insights, 
            <span class="gradient-text">powerful</span> data analytics, 
            and <span class="gradient-text">captivating</span> visualizations
        </p>
        <div class="card" style="margin-top: 5rem;">
            <div class="card-body">
                <h5 class="card-title">{{ title }} <span class="clickable" data-toggle="collapse" data-target="#infoCollapse"><i class="fas fa-info-circle" id="infoBtn"></i></span></h5>
                <div class="collapse" style="margin-bottom: 1rem;" id="infoCollapse">
                    <ul>
                        <li>Located in {{ city }} üìç</li>
                        <li>Condition is {{ condition }}</li>
                        <li>Listed under {{ category }}</li>
                    </ul>
                </div>
                
                <h6 class="card-subtitle mb-2 text-muted">
                    {% if days == 1 and hours == 1 %}
                        Listed {{ days }} day and {{ hours }} hour ago, for ${{ price }}
                    {% elif days == 1 and hours > 1 %}
                        Listed {{ days }} day and {{ hours }} hours ago, for ${{ price }}
                    {% elif days > 1 and hours == 1 %}
                        Listed {{ days }} days and {{ hours }} hour ago, for ${{ price }}
                    {% elif days == 0 and hours == 1 %}
                        Listed {{ hours }} hour ago, for ${{ price }}
                    {% elif days == 0 and hours > 1 %}
                        Listed {{ hours }} hours ago, for ${{ price }}
                    {% elif days == 1 and hours == 0 %}
                        Listed {{ days }} day ago, for ${{ price }}
                    {% elif days > 1 and hours == 0 %}
                        Listed {{ days }} days ago, for ${{ price }}
                    {% else %}
                        Listed {{ days }} days and {{ hours }} hours ago, for ${{ price }}
                    {% endif %}
                </h6>
                <p>
                    Given the sheer variety of product names we encountered, we've taken the liberty of grouping our {{ total_items }} findings into {{ categories|length }} funky and fun categories based 
                    on the lengths of the names. This nifty approach allowed us to whip up some visually engaging graphics that are sure to tickle your fancy while providing valuable insights.
                </p>

                <p>
                    Get ready for some serious fun with our bubble chart! It's like a carnival for your data, with colorful bubbles representing the prices of products in each of the 
                    {{ categories|length }} categories. The bigger and higher a bubble is, the more expensive the product. But don't worry, we've color-coded the bubbles to help you spot the 
                    priciest ones ‚Äì just look for the ones that are redder than a lobster in the sun! And with this playful and intuitive way to explore your data, you'll feel like a kid again!
                </p>
                <div id="chart" data-chart="{{ chart }}"></div>
                <p>
                    Looks like we've found a winner! Our fancy-schmancy algorithm suggests that the <a style="color:#28a745" href="{{ best_similar_url }}" target="_blank">{{ best_similar_description }}</a> product, located in the <span style="color:#28a745">{{ best_similar_category }}</span> category, is the closest match to your list item, with a mind-blowing similarity score of <span style="color:#28a745">{{ best_similar_score }}%</span> and the sweetest price of <span style="color:#28a745">${{ best_similar_price}}</span>.
                    {% if list_best_context.type == "decrease" %}
                        Talk about a bargain! This baby is <span style="color:#28a745">{{ list_best_context.amount }}%</span> cheaper than your original pick!
                    {% else %}
                        Oops, looks like this one's <span style="color:#dc3545">{{ list_best_context.amount }}%</span> more expensive than your original choice.
                    {% endif %}
                    Anyway, we won't tell your list item that you've found a new love üòâ
                </p>
            </div>
        </div>
    </div>

    <script src="{% static 'plotSimilarResults.js' %}"></script>
{% endblock content %}
